/**
 * 14种性格原型化学反应矩阵
 * 定义每对原型之间的兼容性评分 (0-100)
 * 
 * 评分标准：
 * 90-100: 完美互补，火花四溅
 * 75-89: 高度兼容，互相激发
 * 60-74: 良好互动，稳定愉快
 * 45-59: 中等兼容，需要磨合
 * 30-44: 较低兼容，可能冲突
 * 0-29: 不建议配对，高冲突风险
 */

export type ArchetypeName = 
  | "火花塞" | "氛围组" | "连接者"  // Energizers
  | "探索者" | "挑战者" | "智者"    // Intellectuals
  | "肯定者" | "协调者" | "守护者"  // Nurturers
  | "故事家" | "梦想家" | "艺术家"  // Creatives
  | "组织者" | "实干家";            // Pragmatists

// 化学反应矩阵：每对原型的兼容性评分
export const chemistryMatrix: Record<ArchetypeName, Record<ArchetypeName, number>> = {
  // ============ 外向活力型 ============
  "火花塞": {
    "火花塞": 70,    // 双火花可能竞争主导权，但能量爆棚
    "氛围组": 88,    // 完美搭档，一个破冰一个活跃
    "连接者": 85,    // 互补，火花塞开场，连接者深化
    "探索者": 82,    // 火花塞带节奏，探索者深化话题
    "挑战者": 65,    // 火花塞热情可能被挑战者打断
    "智者": 72,      // 平衡，火花塞带动，智者稳定
    "肯定者": 90,    // 完美配合，火花塞发起，肯定者支持
    "协调者": 78,    // 良好，协调者帮火花塞平衡节奏
    "守护者": 75,    // 守护者为火花塞创造安全空间
    "故事家": 86,    // 火花塞开场，故事家接力讲述
    "梦想家": 80,    // 互相激发创意和热情
    "艺术家": 73,    // 艺术家可能觉得火花塞太吵
    "组织者": 68,    // 组织者可能觉得火花塞太随性
    "实干家": 66,    // 实干家偏好具体，火花塞太抽象
  },
  
  "氛围组": {
    "火花塞": 88,
    "氛围组": 75,    // 双氛围组可能过于表演化
    "连接者": 83,    // 氛围组吸引，连接者组织
    "探索者": 77,    // 探索者喜欢深度，氛围组偏轻松
    "挑战者": 60,    // 挑战者严肃，可能打击氛围组
    "智者": 68,      // 智者沉稳，平衡氛围组
    "肯定者": 92,    // 完美搭档，相互鼓励和支持
    "协调者": 80,    // 协调者帮助氛围组控制场面
    "守护者": 78,    // 守护者为氛围组提供安全感
    "故事家": 90,    // 氛围+故事=精彩对话
    "梦想家": 85,    // 双方都充满想象力和乐观
    "艺术家": 82,    // 艺术家欣赏氛围组的表演力
    "组织者": 65,    // 组织者可能觉得氛围组不够专注
    "实干家": 63,    // 实干家可能觉得氛围组太虚
  },
  
  "连接者": {
    "火花塞": 85,
    "氛围组": 83,
    "连接者": 80,    // 双连接者可能过度networking
    "探索者": 88,    // 连接者引荐，探索者深挖
    "挑战者": 72,    // 连接者圆滑，挑战者直接
    "智者": 85,      // 连接者引荐资源，智者提供见解
    "肯定者": 87,    // 双方都善于建立关系
    "协调者": 92,    // 完美配合，都擅长人际协调
    "守护者": 84,    // 守护者保护，连接者拓展
    "故事家": 83,    // 连接者引荐背景，故事家讲述
    "梦想家": 78,    // 连接者务实，梦想家理想
    "艺术家": 75,    // 连接者外向，艺术家内敛
    "组织者": 82,    // 互补，连接者拓展，组织者整合
    "实干家": 79,    // 连接者引资源，实干家执行
  },
  
  // ============ 智慧探索型 ============
  "探索者": {
    "火花塞": 82,
    "氛围组": 77,
    "连接者": 88,
    "探索者": 85,    // 双探索者深度对话，但可能过于发散
    "挑战者": 78,    // 都喜欢思考，但挑战者更激进
    "智者": 90,      // 完美搭档，探索广度+智慧深度
    "肯定者": 75,    // 探索者问题多，肯定者耐心听
    "协调者": 80,    // 协调者帮探索者整理思路
    "守护者": 73,    // 守护者提供安全感让探索者畅所欲言
    "故事家": 87,    // 探索者提问，故事家分享经历
    "梦想家": 92,    // 双方都充满好奇心和想象力
    "艺术家": 86,    // 探索者欣赏艺术家的独特视角
    "组织者": 70,    // 组织者务实，探索者发散
    "实干家": 68,    // 实干家要结果，探索者重过程
  },
  
  "挑战者": {
    "火花塞": 65,
    "氛围组": 60,
    "连接者": 72,
    "探索者": 78,
    "挑战者": 55,    // 双挑战者可能激烈冲突
    "智者": 85,      // 智者能hold住挑战者的锐利
    "肯定者": 68,    // 肯定者可能被挑战者打击
    "协调者": 82,    // 协调者平衡挑战者的激进
    "守护者": 75,    // 守护者保护他人免受挑战者攻击
    "故事家": 70,    // 挑战者可能打断故事家
    "梦想家": 65,    // 挑战者现实，梦想家理想
    "艺术家": 72,    // 挑战者欣赏艺术家的独特性
    "组织者": 77,    // 组织者引导挑战者的能量
    "实干家": 80,    // 都注重实效，互相尊重
  },
  
  "智者": {
    "火花塞": 72,
    "氛围组": 68,
    "连接者": 85,
    "探索者": 90,
    "挑战者": 85,
    "智者": 88,      // 双智者深度对话，但可能过于严肃
    "肯定者": 82,    // 智者提见解，肯定者温暖回应
    "协调者": 87,    // 都善于分析和平衡
    "守护者": 84,    // 智者分析，守护者保护
    "故事家": 80,    // 智者解读，故事家讲述
    "梦想家": 78,    // 智者理性，梦想家感性
    "艺术家": 83,    // 智者欣赏艺术家的洞察
    "组织者": 85,    // 智者策略，组织者执行
    "实干家": 82,    // 智者理论，实干家实践
  },
  
  // ============ 温暖支持型 ============
  "肯定者": {
    "火花塞": 90,
    "氛围组": 92,
    "连接者": 87,
    "探索者": 75,
    "挑战者": 68,
    "智者": 82,
    "肯定者": 85,    // 双肯定者温暖，但可能缺乏方向
    "协调者": 88,    // 完美搭档，都关注他人感受
    "守护者": 90,    // 双方都提供情感支持
    "故事家": 86,    // 肯定者鼓励故事家分享
    "梦想家": 83,    // 肯定者支持梦想家的想法
    "艺术家": 80,    // 肯定者欣赏艺术家的敏感
    "组织者": 75,    // 肯定者温暖，组织者务实
    "实干家": 73,    // 实干家可能觉得肯定者太软
  },
  
  "协调者": {
    "火花塞": 78,
    "氛围组": 80,
    "连接者": 92,
    "探索者": 80,
    "挑战者": 82,
    "智者": 87,
    "肯定者": 88,
    "协调者": 82,    // 双协调者可能过于求稳
    "守护者": 86,    // 都关注团队和谐
    "故事家": 78,    // 协调者平衡，故事家活跃
    "梦想家": 75,    // 协调者务实，梦想家理想
    "艺术家": 77,    // 协调者包容艺术家的独特
    "组织者": 88,    // 完美配合，协调+组织=高效
    "实干家": 85,    // 协调者规划，实干家执行
  },
  
  "守护者": {
    "火花塞": 75,
    "氛围组": 78,
    "连接者": 84,
    "探索者": 73,
    "挑战者": 75,
    "智者": 84,
    "肯定者": 90,
    "协调者": 86,
    "守护者": 88,    // 双守护者安全感强，但可能过于保守
    "故事家": 82,    // 守护者提供安全空间让故事家分享
    "梦想家": 80,    // 守护者保护梦想家的脆弱
    "艺术家": 85,    // 守护者欣赏并保护艺术家
    "组织者": 78,    // 守护者关注人，组织者关注事
    "实干家": 76,    // 守护者柔软，实干家硬朗
  },
  
  // ============ 创意表达型 ============
  "故事家": {
    "火花塞": 86,
    "氛围组": 90,
    "连接者": 83,
    "探索者": 87,
    "挑战者": 70,
    "智者": 80,
    "肯定者": 86,
    "协调者": 78,
    "守护者": 82,
    "故事家": 80,    // 双故事家可能竞争话语权
    "梦想家": 88,    // 故事家讲过去，梦想家讲未来
    "艺术家": 84,    // 都善于表达和感染
    "组织者": 72,    // 组织者可能打断故事家
    "实干家": 70,    // 实干家可能觉得故事家太绕
  },
  
  "梦想家": {
    "火花塞": 80,
    "氛围组": 85,
    "连接者": 78,
    "探索者": 92,
    "挑战者": 65,
    "智者": 78,
    "肯定者": 83,
    "协调者": 75,
    "守护者": 80,
    "故事家": 88,
    "梦想家": 82,    // 双梦想家充满创意，但可能不接地气
    "艺术家": 90,    // 完美搭档，都充满想象力
    "组织者": 68,    // 梦想家天马行空，组织者务实
    "实干家": 65,    // 实干家可能觉得梦想家不切实际
  },
  
  "艺术家": {
    "火花塞": 73,
    "氛围组": 82,
    "连接者": 75,
    "探索者": 86,
    "挑战者": 72,
    "智者": 83,
    "肯定者": 80,
    "协调者": 77,
    "守护者": 85,
    "故事家": 84,
    "梦想家": 90,
    "艺术家": 78,    // 双艺术家可能过于内敛或竞争
    "组织者": 70,    // 艺术家感性，组织者理性
    "实干家": 68,    // 艺术家抽象，实干家具体
  },
  
  // ============ 务实执行型 ============
  "组织者": {
    "火花塞": 68,
    "氛围组": 65,
    "连接者": 82,
    "探索者": 70,
    "挑战者": 77,
    "智者": 85,
    "肯定者": 75,
    "协调者": 88,
    "守护者": 78,
    "故事家": 72,
    "梦想家": 68,
    "艺术家": 70,
    "组织者": 85,    // 双组织者高效，但可能过于机械
    "实干家": 92,    // 完美搭档，组织+执行=成果
  },
  
  "实干家": {
    "火花塞": 66,
    "氛围组": 63,
    "连接者": 79,
    "探索者": 68,
    "挑战者": 80,
    "智者": 82,
    "肯定者": 73,
    "协调者": 85,
    "守护者": 76,
    "故事家": 70,
    "梦想家": 65,
    "艺术家": 68,
    "组织者": 92,
    "实干家": 88,    // 双实干家超高效，但可能缺乏创意
  },
};

/**
 * 获取两个原型之间的化学反应分数
 */
export function getChemistryScore(archetype1: ArchetypeName, archetype2: ArchetypeName): number {
  return chemistryMatrix[archetype1]?.[archetype2] ?? 50; // 默认中等兼容
}

/**
 * 获取化学反应等级描述
 */
export function getChemistryLevel(score: number): {
  level: string;
  description: string;
  color: string;
} {
  if (score >= 90) {
    return {
      level: "完美互补",
      description: "火花四溅，思维碰撞激烈",
      color: "text-purple-600 dark:text-purple-400"
    };
  } else if (score >= 75) {
    return {
      level: "高度兼容",
      description: "互相激发，对话流畅",
      color: "text-green-600 dark:text-green-400"
    };
  } else if (score >= 60) {
    return {
      level: "良好互动",
      description: "稳定愉快，氛围和谐",
      color: "text-blue-600 dark:text-blue-400"
    };
  } else if (score >= 45) {
    return {
      level: "中等兼容",
      description: "需要磨合，可能有小摩擦",
      color: "text-yellow-600 dark:text-yellow-400"
    };
  } else if (score >= 30) {
    return {
      level: "较低兼容",
      description: "容易冲突，需要协调者",
      color: "text-orange-600 dark:text-orange-400"
    };
  } else {
    return {
      level: "不建议配对",
      description: "高冲突风险，慎重考虑",
      color: "text-red-600 dark:text-red-400"
    };
  }
}

/**
 * 计算一组用户的平均化学反应分数
 */
export function calculateGroupChemistry(archetypes: ArchetypeName[]): number {
  if (archetypes.length < 2) return 0;
  
  let totalScore = 0;
  let pairCount = 0;
  
  for (let i = 0; i < archetypes.length; i++) {
    for (let j = i + 1; j < archetypes.length; j++) {
      totalScore += getChemistryScore(archetypes[i], archetypes[j]);
      pairCount++;
    }
  }
  
  return pairCount > 0 ? Math.round(totalScore / pairCount) : 0;
}

/**
 * 推荐最佳配对原型
 */
export function getBestMatchArchetypes(archetype: ArchetypeName, count: number = 3): ArchetypeName[] {
  const scores = Object.entries(chemistryMatrix[archetype])
    .filter(([other]) => other !== archetype)
    .sort(([, scoreA], [, scoreB]) => scoreB - scoreA)
    .slice(0, count)
    .map(([name]) => name as ArchetypeName);
  
  return scores;
}

/**
 * 推荐应避免的配对原型
 */
export function getWorstMatchArchetypes(archetype: ArchetypeName, count: number = 3): ArchetypeName[] {
  const scores = Object.entries(chemistryMatrix[archetype])
    .filter(([other]) => other !== archetype)
    .sort(([, scoreA], [, scoreB]) => scoreA - scoreB)
    .slice(0, count)
    .map(([name]) => name as ArchetypeName);
  
  return scores;
}
